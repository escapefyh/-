<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- 搜索框 -->
  <view class="search-section">
    <view class="search-container">
      <view class="search-input-wrapper">
        <text class="search-icon">🔍</text>
        <input
          class="search-input"
          type="text"
          value="{{searchKeyword}}"
          placeholder="搜索商品"
          confirm-type="search"
          bindinput="onSearchInput"
          bindconfirm="onSearch"
        />
        <view 
          wx:if="{{searchKeyword}}"
          class="search-clear"
          catchtap="onSearchClear"
        >
          <text>×</text>
        </view>
      </view>
      <view class="search-button" catchtap="onSearchButtonClick">
        <text>搜索</text>
      </view>
    </view>
  </view>
<!-- 只要触发了绑定事件，就会生成一个对象并传入js，通常在js里面用e来接收。
在e.detail里面会有官方定义好的参数，自己也可以强行传入参数，data-名字="值"
最后在e.currentTarget.dataset中可以找到 -->
  <!-- 导航栏 -->
  <view class="nav-section">
    <view class="nav-tabs">
      <view 
        class="nav-tab {{currentTab === 'follow' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="follow"
      >
        <text>关注</text>
        <view class="nav-tab-indicator"></view>
      </view>
      <view 
        class="nav-tab {{currentTab === 'recommend' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="recommend"
      >
        <text>推荐</text>
        <view class="nav-tab-indicator"></view>
      </view>
      <view 
        class="nav-tab {{currentTab === 'new' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="new"
      >
        <text>新发</text>
        <view class="nav-tab-indicator"></view>
      </view>
    </view>
  </view>

  <!-- 商品分类横向滚动 -->
  <view class="category-section">
    <swiper
      class="category-swiper"
      indicator-dots="{{categoryTotalPages > 1}}"
      indicator-color="rgba(0, 0, 0, 0.2)"
      indicator-active-color="#0052d9"
      autoplay="{{false}}"
      current="{{categoryCurrentPage}}"
      bindchange="onCategorySwiperChange"
    >
      <swiper-item wx:for="{{categoryPages}}" wx:key="index" class="category-swiper-item">
        <view class="category-grid">
          <view 
            class="category-item" 
            wx:for="{{item}}" 
            wx:for-item="category"
            wx:key="category_id"
            bind:tap="onCategoryClick"
            data-category-id="{{category.category_id}}"
            data-category-name="{{category.name}}"
          >
            <view class="category-image-wrapper">
              <image 
                class="category-image" 
                src="{{category.image}}" 
                mode="aspectFill"
              />
            </view>
            <view class="category-name">{{category.name}}</view>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- 商品列表 -->
  <view class="goods-section">
    <!-- 加载中状态 -->
    <view wx:if="{{loading && goodsList.length === 0}}" class="loading-container">
      <text>加载中...</text>
    </view>

    <!-- 空状态 -->
    <view wx:elif="{{!loading && goodsList.length === 0}}" class="empty-container">
      <text wx:if="{{isSearching}}">无搜索结果</text>
      <text wx:elif="{{currentTab === 'follow'}}">暂无关注用户发布的商品</text>
      <text wx:elif="{{currentTab === 'new'}}">最近7天暂无新发布的商品</text>
      <text wx:else>暂无商品</text>
    </view>

    <!-- 商品网格 -->
    <view wx:else class="goods-grid">
      <view 
        class="goods-item" 
        wx:for="{{goodsList}}" 
        wx:key="goods_id"
        bind:tap="onGoodsClick"
        data-goods-id="{{item.goods_id}}"
      >
        <!-- 商品图片 -->
        <view class="goods-image-wrapper">
          <image 
            wx:if="{{item.images && item.images.length > 0}}"
            class="goods-image" 
            src="{{item.images[0]}}" 
            mode="aspectFill"
            binderror="onImageError"
            data-index="{{index}}"
            lazy-load="{{true}}"
          />
          <image 
            wx:else
            class="goods-image" 
            src="/assets/store.png" 
            mode="aspectFill"
          />
          <view wx:if="{{item.group_buy_enabled}}" class="group-buy-badge">
            <text>拼团</text>
          </view>
          <view wx:if="{{item.isNew}}" class="new-badge">
            <text>NEW</text>
          </view>
        </view>

        <!-- 商品信息 -->
        <view class="goods-info">
          <!-- 商品描述（最多两行） -->
          <view class="goods-description">{{item.description}}</view>
          
          <!-- 价格 -->
          <view class="goods-price">¥{{item.price}}</view>
          
          <!-- 发布者信息 -->
          <view class="goods-seller">
            <text class="seller-name">{{item.seller && (item.seller.nickname || item.seller.name) || '未设置昵称'}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 加载更多提示 -->
    <view wx:if="{{loading && goodsList.length > 0}}" class="loading-more">
      <text>加载中...</text>
    </view>
    <view wx:if="{{!hasMore && goodsList.length > 0}}" class="no-more">
      <text>没有更多了</text>
    </view>
  </view>
</view>






