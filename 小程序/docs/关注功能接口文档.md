# 关注功能接口文档

## 概述

本文档描述了关注功能相关的后端接口，包括关注/取消关注、查询关注状态、获取关注列表等功能。

---

## 1. 检查关注状态

**接口地址：** `GET /follow/check`

**功能描述：** 检查当前用户是否已关注指定用户

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string/int | 是 | 当前用户ID |
| followed_id | string/int | 是 | 被关注用户ID |

**请求示例：**
```
GET /follow/check?user_id=123&followed_id=456
```

**响应示例：**
```json
{
  "msg": "success",
  "data": {
    "is_followed": true
  }
}
```

**响应字段说明：**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| is_followed | boolean | 是否已关注，true表示已关注，false表示未关注 |

---

## 2. 关注/取消关注

**接口地址：** `POST /follow/toggle`

**功能描述：** 切换关注状态（如果已关注则取消关注，如果未关注则关注）

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string/int | 是 | 当前用户ID |
| followed_id | string/int | 是 | 被关注用户ID |

**请求示例：**
```json
{
  "user_id": "123",
  "followed_id": "456"
}
```

**响应示例：**
```json
{
  "msg": "success",
  "data": {
    "is_followed": true
  }
}
```

**响应字段说明：**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| is_followed | boolean | 操作后的关注状态，true表示已关注，false表示未关注 |

**业务逻辑：**
- 如果当前用户已关注该用户，则取消关注
- 如果当前用户未关注该用户，则添加关注
- 不能关注自己（前端已做判断，后端也需要校验）

---

## 3. 获取关注列表

**接口地址：** `GET /follow/list`

**功能描述：** 获取当前用户关注的所有用户列表（分页）

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string/int | 是 | 当前用户ID |
| page | int | 否 | 页码，默认为1 |
| pageSize | int | 否 | 每页数量，默认为10 |

**请求示例：**
```
GET /follow/list?user_id=123&page=1&pageSize=10
```

**响应示例：**
```json
{
  "msg": "success",
  "data": {
    "list": [
      {
        "user_id": "456",
        "nickname": "卖家昵称",
        "name": "卖家名称",
        "avatar": "https://example.com/avatar.jpg",
        "goods_count": 15
      }
    ],
    "total": 25
  }
}
```

**响应字段说明：**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list | array | 关注用户列表 |
| list[].user_id | string/int | 用户ID |
| list[].nickname | string | 用户昵称 |
| list[].name | string | 用户名称（备用字段） |
| list[].avatar | string | 用户头像URL |
| list[].goods_count | int | 该用户发布的商品数量 |
| total | int | 总记录数 |

---

## 4. 获取关注数量

**接口地址：** `GET /follow/count`

**功能描述：** 获取当前用户的关注数量

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string/int | 是 | 当前用户ID |

**请求示例：**
```
GET /follow/count?user_id=123
```

**响应示例：**
```json
{
  "msg": "success",
  "data": {
    "count": 25
  }
}
```

**响应字段说明：**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| count | int | 关注数量 |

---

## 5. 商品列表接口（支持按卖家查询）

**接口地址：** `GET /goods/list`

**功能描述：** 获取商品列表，支持按卖家ID筛选

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码，默认为1 |
| pageSize | int | 否 | 每页数量，默认为10 |
| category_id | int | 否 | 分类ID（可选） |
| keyword | string | 否 | 搜索关键词（可选） |
| seller_id | string/int | 否 | 卖家ID（可选，新增参数） |

**请求示例：**
```
GET /goods/list?page=1&pageSize=10&seller_id=456
```

**响应示例：**
```json
{
  "msg": "success",
  "data": {
    "list": [
      {
        "goods_id": "789",
        "description": "商品描述",
        "price": 100.00,
        "images": ["https://example.com/image1.jpg"],
        "seller": {
          "user_id": "456",
          "nickname": "卖家昵称",
          "name": "卖家名称",
          "avatar": "https://example.com/avatar.jpg"
        },
        "sales_count": 10,
        "group_buy_enabled": false
      }
    ],
    "total": 50
  }
}
```

**响应字段说明：**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| list | array | 商品列表 |
| list[].goods_id | string/int | 商品ID |
| list[].description | string | 商品描述 |
| list[].price | float | 商品价格 |
| list[].images | array | 商品图片列表 |
| list[].seller | object | 卖家信息 |
| list[].seller.user_id | string/int | 卖家用户ID |
| list[].seller.nickname | string | 卖家昵称 |
| list[].seller.name | string | 卖家名称 |
| list[].seller.avatar | string | 卖家头像 |
| list[].sales_count | int | 销量 |
| list[].group_buy_enabled | boolean | 是否开启拼团 |
| total | int | 总记录数 |

**业务逻辑：**
- 当传入 `seller_id` 参数时，只返回该卖家发布的商品
- 支持与其他筛选条件（category_id、keyword）组合使用

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| success | 操作成功 |
| error | 操作失败，具体错误信息在 error 字段中 |

**错误响应示例：**
```json
{
  "msg": "error",
  "error": "不能关注自己"
}
```

---

## 数据库设计建议

### 关注表（follow）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | int | 主键，自增 |
| user_id | int | 关注者用户ID |
| followed_id | int | 被关注者用户ID |
| create_time | datetime | 关注时间 |
| PRIMARY KEY (id) | | |
| UNIQUE KEY (user_id, followed_id) | | 防止重复关注 |

**索引建议：**
- 在 `user_id` 上创建索引，用于快速查询用户的关注列表
- 在 `followed_id` 上创建索引，用于快速查询被关注者

---

## 前端功能说明

### 1. 商品详情页面
- 在卖家信息行最右边显示关注按钮
- 如果卖家是当前用户自己，则不显示关注按钮
- 点击关注按钮可以关注/取消关注
- 点击卖家头像可以跳转到该卖家的商品列表页面

### 2. 我的关注页面
- 显示当前用户关注的所有用户列表
- 每个用户项显示：头像、昵称、发布的商品数量
- 点击用户项可以跳转到该用户的商品列表页面
- 可以取消关注

### 3. 商品列表页面
- 支持通过 `seller_id` 参数筛选特定卖家的商品
- 页面标题显示为"卖家名称的商品"

---

## 注意事项

1. **不能关注自己**：前端和后端都需要校验，用户不能关注自己
2. **防重复关注**：数据库层面通过唯一索引防止重复关注
3. **关注数量统计**：在个人中心显示关注数量时，使用 `/follow/count` 接口
4. **分页加载**：关注列表和商品列表都支持分页加载，提升性能

---

## 更新日志

- 2024-01-XX：初始版本，实现关注功能基础接口


