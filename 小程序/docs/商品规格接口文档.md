# 商品规格功能接口文档

## 概述

本文档描述了商品发布接口中新增的规格功能相关字段和数据结构。规格功能允许卖家为商品添加多个SKU选项，每个选项包含独立的名称、价格和库存。

## 接口信息

### 发布商品接口

**接口地址：** `/goods/publish`

**请求方法：** `POST`

**Content-Type：** `application/json`

---

## 请求参数

### 基础字段（保持不变）

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | Integer | 是 | 用户ID（卖家ID） |
| images | Array<String> | 是 | 商品图片URL数组 |
| description | String | 是 | 商品描述 |
| price | Float | 是 | 商品基础价格（当开启规格时，此价格可作为参考价或默认价格） |
| category_id | Integer | 是 | 商品分类ID |
| groupBuyEnabled | Boolean | 否 | 是否开启拼团购买 |
| groupBuyCount | Integer | 否 | 拼单人数（开启拼团时必填，范围：2-5） |
| groupBuyDiscount | Float | 否 | 拼团折扣（开启拼团时必填，范围：0 < discount < 1） |

### 新增规格相关字段

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| specEnabled | Boolean | 否 | 是否开启规格功能，默认：false |
| specs | Array<SpecOption> | 否 | 规格选项数组（当 specEnabled 为 true 时必填） |

### SpecOption 规格选项对象

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| name | String | 是 | 规格选项名称（如：【2双】7A抗菌除臭/轻弹减震、【3双】7A抗菌除臭/轻弹减震等） |
| price | Float | 是 | 该规格选项的价格（必须大于0） |
| stock | Integer | 是 | 该规格选项的库存数量（必须大于等于0） |

---

## 请求示例

### 示例1：不开启规格的商品

```json
{
  "user_id": 123,
  "images": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg"
  ],
  "description": "这是一件优质的商品",
  "price": 99.99,
  "category_id": 1,
  "groupBuyEnabled": false,
  "specEnabled": false,
  "specs": null
}
```

### 示例2：开启规格的商品（单个选项）

```json
{
  "user_id": 123,
  "images": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg"
  ],
  "description": "这是一件优质的商品",
  "price": 99.99,
  "category_id": 1,
  "groupBuyEnabled": false,
  "specEnabled": true,
  "specs": [
    {
      "name": "【2双】7A抗菌除臭/轻弹减震",
      "price": 16.90,
      "stock": 100
    }
  ]
}
```

### 示例3：开启规格的商品（多个选项）

```json
{
  "user_id": 123,
  "images": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg"
  ],
  "description": "这是一件优质的商品",
  "price": 16.90,
  "category_id": 1,
  "groupBuyEnabled": false,
  "specEnabled": true,
  "specs": [
    {
      "name": "【2双】7A抗菌除臭/轻弹减震",
      "price": 16.90,
      "stock": 100
    },
    {
      "name": "【3双】7A抗菌除臭/轻弹减震",
      "price": 24.90,
      "stock": 80
    },
    {
      "name": "【4双】7A抗菌除臭/轻弹减震",
      "price": 32.90,
      "stock": 50
    },
    {
      "name": "【2双】7A抗菌防臭/轻弹减震-黑色",
      "price": 16.90,
      "stock": 60
    },
    {
      "name": "【3双】7A抗菌防臭/轻弹减震-黑色",
      "price": 24.90,
      "stock": 40
    },
    {
      "name": "【4双】7A抗菌防臭/轻弹减震-黑色",
      "price": 32.90,
      "stock": 30
    }
  ]
}
```

### 示例4：开启规格的商品（多个选项 + 拼团）

```json
{
  "user_id": 123,
  "images": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg"
  ],
  "description": "这是一件优质的商品",
  "price": 16.90,
  "category_id": 1,
  "groupBuyEnabled": true,
  "groupBuyCount": 3,
  "groupBuyDiscount": 0.85,
  "specEnabled": true,
  "specs": [
    {
      "name": "【2双】7A抗菌除臭/轻弹减震",
      "price": 16.90,
      "stock": 100
    },
    {
      "name": "【3双】7A抗菌除臭/轻弹减震",
      "price": 24.90,
      "stock": 80
    },
    {
      "name": "【4双】7A抗菌除臭/轻弹减震",
      "price": 32.90,
      "stock": 50
    }
  ]
}
```

### 示例5：复杂规格名称示例

```json
{
  "user_id": 123,
  "images": [
    "https://example.com/image1.jpg"
  ],
  "description": "优质鞋垫",
  "price": 16.90,
  "category_id": 5,
  "groupBuyEnabled": false,
  "specEnabled": true,
  "specs": [
    {
      "name": "【1双】7A抗菌除臭/轻弹减震",
      "price": 9.90,
      "stock": 200
    },
    {
      "name": "【2双】7A抗菌除臭/轻弹减震",
      "price": 16.90,
      "stock": 150
    },
    {
      "name": "【2双】抗菌防臭/高弹减震-绿黑",
      "price": 18.90,
      "stock": 100
    },
    {
      "name": "【3双】抗菌防臭/高弹减震-绿黑",
      "price": 26.90,
      "stock": 80
    },
    {
      "name": "【4双】抗菌防臭/高弹减震-绿黑",
      "price": 34.90,
      "stock": 60
    }
  ]
}
```

---

## 数据验证规则

### 基础验证

1. **specEnabled 字段**
   - 类型：Boolean
   - 当 `specEnabled = true` 时，`specs` 字段必填且不能为空数组
   - 当 `specEnabled = false` 时，`specs` 字段应为 `null` 或不传

2. **specs 数组验证**
   - 当 `specEnabled = true` 时，`specs` 数组长度必须大于 0
   - 每个规格选项必须包含 `name`、`price`、`stock` 字段

3. **规格选项（SpecOption）验证**
   - `name` 字段：
     - 必填，字符串类型
     - 不能为空或仅包含空格
     - 建议长度：1-100 个字符
   - `price` 字段：
     - 必填，浮点数类型
     - 必须大于 0
     - 建议保留 2 位小数
   - `stock` 字段：
     - 必填，整数类型
     - 必须大于等于 0
     - 库存为 0 时表示该规格暂时缺货

### 业务逻辑验证

1. **价格验证**
   - 规格选项的价格必须大于 0
   - 建议保留 2 位小数
   - 价格范围建议：0.01 - 999999.99

2. **库存验证**
   - 规格选项的库存必须大于等于 0
   - 库存为 0 时表示该规格暂时缺货，买家可以选择但无法购买

3. **规格名称建议**
   - 规格名称应该清晰描述商品的不同选项
   - 常见格式：
     - `【数量】功能描述`（如：【2双】7A抗菌除臭/轻弹减震）
     - `【数量】功能描述-颜色`（如：【2双】7A抗菌防臭/轻弹减震-黑色）
     - `【数量】功能描述/特性-颜色`（如：【2双】抗菌防臭/高弹减震-绿黑）

4. **商品总库存**
   - 当开启规格时，商品总库存 = 所有规格选项库存之和
   - 需要根据所有规格选项的库存判断商品是否可售

---

## 响应格式

### 成功响应

```json
{
  "msg": "success",
  "data": {
    "goods_id": 12345,
    "message": "商品发布成功"
  }
}
```

### 错误响应

#### 错误1：规格相关字段验证失败

```json
{
  "msg": "error",
  "error": "请至少添加一个规格选项"
}
```

```json
{
  "msg": "error",
  "error": "第1个规格选项的名称不能为空"
}
```

```json
{
  "msg": "error",
  "error": "第2个规格选项\"【3双】7A抗菌除臭/轻弹减震\"的价格必须大于0"
}
```

```json
{
  "msg": "error",
  "error": "第3个规格选项\"【4双】7A抗菌除臭/轻弹减震\"的库存必须大于等于0"
}
```

#### 错误2：规格数据格式错误

```json
{
  "msg": "error",
  "error": "规格数据格式错误：specs 必须是数组类型"
}
```

```json
{
  "msg": "error",
  "error": "规格选项缺少必填字段：name"
}
```

---

## 数据库设计建议

### 商品表（goods）

保持原有字段不变，新增字段：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| spec_enabled | Boolean | 是否开启规格 |

### 规格选项表（spec_options）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| spec_option_id | Integer | 规格选项ID（主键） |
| goods_id | Integer | 商品ID（外键） |
| name | String(200) | 规格选项名称 |
| price | Decimal(10,2) | 价格 |
| stock | Integer | 库存 |
| sort_order | Integer | 排序顺序（用于控制前端显示顺序） |
| created_at | DateTime | 创建时间 |
| updated_at | DateTime | 更新时间 |

### 数据库关系

```
goods (1) ----< (N) spec_options
```

### 索引建议

- `goods_id` 字段建议添加索引，便于查询某个商品的所有规格选项
- `spec_option_id` 字段为主键，自动创建索引

---

## 前端实现说明

### 功能特性

1. **规格开关**
   - 用户可以通过开关控制是否开启规格功能
   - 关闭规格时，清空所有规格选项数据

2. **规格选项管理**
   - 支持添加多个规格选项
   - 每个规格选项包含：名称、价格、库存
   - 支持删除规格选项
   - 支持编辑规格选项的所有字段

3. **数据验证**
   - 前端会进行基础验证，确保数据格式正确
   - 后端需要再次验证，确保数据完整性和安全性

### 前端数据结构

```javascript
{
  specEnabled: false,  // 是否开启规格
  specOptions: [      // 规格选项数组
    {
      name: "【2双】7A抗菌除臭/轻弹减震",  // 规格选项名称
      price: "16.90",  // 价格（字符串，用于输入）
      stock: "100"     // 库存（字符串，用于输入）
    },
    {
      name: "【3双】7A抗菌除臭/轻弹减震",
      price: "24.90",
      stock: "80"
    }
  ]
}
```

### 提交时数据转换

前端在提交前会将字符串类型的价格和库存转换为数字类型：

```javascript
specs: [
  {
    name: "【2双】7A抗菌除臭/轻弹减震",
    price: 16.90,  // 转换为浮点数
    stock: 100     // 转换为整数
  },
  {
    name: "【3双】7A抗菌除臭/轻弹减震",
    price: 24.90,
    stock: 80
  }
]
```

---

## 买家端展示说明

### 商品详情页展示

当商品开启规格时，买家在商品详情页应该看到：

1. **规格选项列表**
   - 以可滚动的列表形式展示所有规格选项
   - 每个选项显示：缩略图（可选）、名称、价格、库存状态
   - 选中的选项高亮显示（如橙色背景）

2. **价格显示**
   - 显示当前选中规格选项的价格
   - 如果未选中，可以显示最低价格或基础价格

3. **库存显示**
   - 显示当前选中规格选项的库存
   - 库存为 0 时，该选项应标记为"缺货"或不可选

4. **选择交互**
   - 买家点击某个规格选项时，该选项被选中
   - 选中的选项高亮显示
   - 价格和库存信息更新为选中选项的值

### 示例展示效果

```
┌─────────────────────────────────┐
│ 【2双】7A抗菌除臭/轻弹减震      │ ← 选中（橙色背景）
│ ¥16.90  库存：100                │
├─────────────────────────────────┤
│ 【3双】7A抗菌除臭/轻弹减震      │
│ ¥24.90  库存：80                 │
├─────────────────────────────────┤
│ 【4双】7A抗菌除臭/轻弹减震      │
│ ¥32.90  库存：50                 │
├─────────────────────────────────┤
│ 【2双】7A抗菌防臭/轻弹减震-黑色 │
│ ¥16.90  库存：60                 │
└─────────────────────────────────┘
```

---

## 注意事项

1. **向后兼容**
   - 如果商品不开启规格（`specEnabled = false`），`specs` 字段应为 `null` 或不传
   - 原有的商品发布逻辑不受影响

2. **价格处理**
   - 当开启规格时，商品的基础 `price` 字段仍然保留
   - 建议将基础价格设置为最低规格价格或作为参考价
   - 实际购买价格以选中规格选项的价格为准

3. **库存管理**
   - 当开启规格时，商品总库存 = 所有规格选项库存之和
   - 需要根据规格选项库存判断商品是否可售
   - 库存扣减时，需要扣减对应规格选项的库存

4. **规格选项排序**
   - 建议在数据库中添加 `sort_order` 字段，用于控制前端显示顺序
   - 前端提交时可以不包含排序字段，后端按照提交顺序设置排序

5. **数据存储**
   - 建议将规格选项数据存储在独立的 `spec_options` 表中
   - 便于后续的查询、修改和管理
   - 删除商品时，需要级联删除相关的规格选项

6. **规格名称规范**
   - 规格名称应该清晰明确，便于买家理解
   - 建议卖家在名称中包含关键信息：数量、功能、颜色、尺寸等
   - 前端可以提示卖家如何填写规格名称

---

## 更新日志

- **2024-XX-XX**：初始版本，添加商品规格功能接口文档（SKU选项形式）

---

## 联系方式

如有疑问，请联系后端开发团队。
